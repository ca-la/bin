#!/bin/bash
set -e
set -o noglob

# Run the test suite
# Usage: `bin/test`

source bin/lib/loadenv
loadenv-test

if [ "$CI" == "true" ]; then
  mkdir -p ./reports
  npx tape "dist/**/*spec.js" | npx tap-xunit > ./reports/tape.xml
else
  echo "Building..."
  bin/lib/build
  echo "Linting..."
  bin/lint
  echo "Testing..."
  npx tape "dist/**/*spec.js" | npx tap-difflet --pessimistic
fi
