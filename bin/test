#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail
set -o noglob

# Run the test suite
# Usage: bin/test

main() {
  source bin/lib/loadenv

  loadenv_test

  ci=${CI:-"false"}
  if [ "$ci" == "true" ]; then
    mkdir -p ./reports
    npx tape "dist/**/*spec.js" | npx tap-xunit > ./reports/tape.xml
  else
    node -r ts-node/register --preserve-symlinks $(npm bin)/tape "src/**/*spec.[jt]s" | npx tap-difflet --pessimistic
  fi
}

main "$@"
