#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail
set -o noglob

# Purges all unsent/unread notifications
# Usage: bin/purge_notifications <local|staging|production|demo>

main() {
  source bin/lib/loadenv
  source bin/lib/clean
  source bin/lib/build

  host=${1:-""}

  case "$host" in
    local)
      loadenv_local
      npx ts-node src/workers/purge-notifications/index.ts
      ;;
    staging|production|demo)
      clean
      build
      node dist/workers/purge-notifications/index.js
      ;;
    *)
      echo 'Usage: bin/purge_notifications <local|staging|production|demo>'
      exit 1
      ;;
  esac
}

main "$@"
