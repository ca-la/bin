#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail
set -o noglob

# Create a new migration file
# Usage: bin/create_migration <migration name>

main() {
  name=${1:-""}

  if [[ "$name" == "" ]]; then
    echo "Usage: create_migration [migration-name]"
    exit 1
  fi

  date_stamp=$(date "+%Y%m%d%H%M%S")

  filename=src/migrations/$date_stamp'_'$name.ts
  cp src/migrations/_template $filename
  echo 'Created '$filename

  echo -n 'Open in '$EDITOR'? [y/n] '
  read -n 1 should_edit

  if [[ "$should_edit" == "y" ]]; then
    $EDITOR $filename
  fi
}

main "$@"
