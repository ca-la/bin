#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail
set -o noglob

# Start up production API server
# Relies on config specified in environment variables; does not read from .env

usage() {
  echo "Usage: bin/run <api|api-worker>"
  exit 1
}

DEFAULT_APP=api

run() {
  if [ ! -d "dist" ]; then
    echo 'No built application found in dist/ directory'
    exit 1
  fi

  app_to_run=${1:-$DEFAULT_APP}
  case "$app_to_run" in
    api)
      node dist
      ;;
    api-worker)
      node dist/workers/api-worker
      ;;
    *)
      usage
      ;;
  esac

}

run "$@"
