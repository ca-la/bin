#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail
set -o noglob

# Run server with ts-node watching for changes
# Usage: bin/dev

run() {
  source bin/lib/loadenv
  loadenv_local

  nodemon_opts=""

  while getopts "i" opt; do
    case $opt in
      i)
        nodemon_opts="--inspect"
        ;;
      *)
        echo 'Usage: bin/dev [-i]'
        echo 'Options:'
        echo ' -i Enable inspector'
        exit 1
        ;;
      esac
  done

  npx nodemon $nodemon_opts -e '[t|j]s' -w ./src -r 'ts-node/register' ./src
}

run "$@"
