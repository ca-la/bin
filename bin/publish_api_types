#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail
set -o noglob

# Builds and publishes the `@cala/api-types` package from the exports of
# `src/published-types`.

main() {
  rm -rf published-types-dist
  npx tsc --build src/published-types/tsconfig.json

  (
    cd src/published-types
    npm version --allow-same-version $(node -p "require('../../package.json').version")
  )

  cp src/published-types/package.json published-types-dist

  (
    cd published-types-dist
    npm publish
  )
}

main "$@"
